<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>OrChem: information for developers </title>
    <link rel="stylesheet" href="orchem.css" type="text/css"></link>
  </head>
  <body>
    <br>
    <img src="logo.small.jpg"></img>
    <h1>Development </h1> 

    <div class="main">
      <a href="index.html">Back to main page</a>
      <table width="70%" border="0" cellspacing="10" cellpadding="10">
        <tr>
          <td>
            <h3>Introduction</h3>
            This page contains pointers for people developing OrChem.
          </td>
        </tr>
        <tr>
          <td>
            <h3>Unit testing</h3>
            OrChem consists of Oracle and Java components;  both need to
            be part of the unit test process.<br></br>
            A framework has been set up to 
            test everything from setting up a new OrChem schema to similarity and 
            substructure searching. You can run the test suite from the command line. 
            Both Linux and Windows are supported by the framework.<br>
            To use the framework, you must have <b>Perl</b> and <b>Ant</b> installed
            (download and install if necessary before continuing).
            <br></br>
            In cvs directory "OrChem/test" you can find the test framework. 
            The idea is that after making changes to 
            OrChem, you execute the complete set of test steps.
            This way, you'll be testing not just Java but also Oracle components and
            the dependencies between Java and the database.<br>
            
            <h5>Setting up the unit test</h5>
            <ul>
            <li>
            Create a blank Oracle schema in a
            test database. The schema is to be for testing only, we'll populate it
            later on with disposable data.
            </li>
            <li>
            Navigate to directory OrChem/properties. Copy file "unittest.properties" into 
            subdirectory "my_local_copies". Navigate to "my_local_copies".
            The unit test framework will use this particular file
            for its database connections. Do NOT add this copy to CVS. Just modify the
            file by providing the correct database details.
            </li>
            <li>
            Navigate to directory "OrChem/test". Type <b>perl main.pl</b><br>
            You'll see the screen below.
<pre>
________________________________________________________________

 OrChem unit testing
________________________________________________________________

Reading file unittest.properties

   username : testuser
   password : testpw
   url      : jdbc:oracle:thin:@172.22.69.139:1521:marx
   tns name : marx

BEFORE YOU PROCEED: realise that step 1 of the test suite DROPS all OrChem objects in this schema!
Do you want to test with these settings ?

Enter y or n:

</pre>
            Check that the database connection details are correct. If so, type <b>y</b>.
            You will then get to the main menu below.<br> 
            The menu options are listed in logical order. If you run
            the test for the first time, start with Option 1, then Option 2 etc.
<pre>
________________________________________________________________

 OrChem unit testing
________________________________________________________________


   Oper.syst: linux
   username : TESTUSER
   password : testpw
   url      : jdbc:oracle:thin:@172.22.69.139:1521:marx
   tns name : marx

 - Option 1: - drop ALL(!!) user database objects
               create fresh schema
               load (query) compounds
 - Option 2: - loadjava
 - Option 3: - fingerprinting
 - Option 4: - JUnit test similarity search
 - Option 5: - JUnit test substructure search
 - Option 6: - JUnit test convert

 - Option 0: - EXIT

________________________________________________________________

Please make a choice from the menu above.
Enter menu option :

</pre>
            <ul>
            <li>Option 1 drops OrChem objects in the test schema and 
            creates a schema from scratch using the scripts in ./OrChem/sql. 
            After that some sample data is loaded into
            the empty test schema, only a few hundred compounds in total.  </li>
            <li>Option 2 compiles the OrChem classes and selects
            a number of these to get bundled into an OrChem jar file. This OrChem
            jar together with more static other jars (cdk jar, log4j etc) are
            then loaded into the test schema. </li>
            <li>Option 3 runs the OrChem fingerprinter against the sample
            data. Tables ORCHEM_FINGPRINT_SIMSEARCH and ORCHEM_FINGPRINT_SUBSEARCH
            get populated in this process.</li>
            <li>Option 4 is a JUnit test, testing expected similarity search
            results against the sample data. So whenever you change the
            fingerprinter, or add more compounds to the sample, you are likely
            to have to change the JUnit expected outcome.</li>
            <li>Option 5, same as Option 4 but now testing substructure
            searching.</li>
            <li>Option 6 offers JUnit tests for various file conversions</li>
	    </ul>
            </li>
            </ul>
	   </td>
        </tr>

	<tr>
          <td>
            <h3>Creating an InChi jar file</h3>
	    The InChi jar file contains on big Java class created by NestedVM. 
	    The InChi IUPAC software is written in C, and NestedVM is capable of compiling it into a Java class.
	    What follows are the steps necessary to create the jar file from the C source code.
	    <UL>
	    <LI>Download <A href="http://nestedvm.ibex.org/">NestedVm</a> by making a <A href="http://git-scm.com/">Git</A> clone
	         as decribed on the NestedVM website. 
	    <LI>Install NestedVM on your computer (we installed it on Linux), by running the make command in the downloaded directory.
	         You'll need <A href="http://darcs.net/">darcs</a> installed as well. For more info on NestedVM, consult this <A href="http://wiki.brianweb.net/NestedVM/QuickStartGuide">Wiki</A> page</LI>
	    <LI>With NestedVM installed, download the zipped InChi source code from the <A href="http://www.iupac.org/inchi/download/index.html">IUPAC</a> download site.</LI>
	    <LI>Unzip InChi download and locate the makefile in ./STDINCHI-1-API/STDINCHI/gcc_makefile/makefile </LI>
	    <LI>In this makefile, change the lines below accordingly:
<PRE>
...
  
  INCHI_EXECUTABLE = stdinchi-1.mips
endif

# === Linker to create Main program =====
ifndef LINKER
  LINKER = mips-unknown-elf-gcc
endif

# === C Compiler ===============
ifndef C_COMPILER
  C_COMPILER =mips-unknown-elf-gcc
endif

...
</PRE>	    
	    
	    </LI>
	    <LI>Run the make command, resulting in a file stdinchi-1.mips </LI>
	    <LI>Run NestedVM like below (example is run from NestedVM dir, replace YOUR_MAKE_DIR with correct value)
	    <PRE>
java org.ibex.nestedvm.Compiler -outfile org/iupac/StdInchi102.class org.iupac.StdInchi102 YOUR_MAKE_DIR/stdinchi-1.mips
	    </PRE>	    
	    </LI>
	    <LI>You can now test the class file:
	    <PRE>
make env.sh
java -cp org/iupac/StdInchi102    
	    </PRE>	    
	    </LI>
	    </UL>	    
	   </td>
        </tr>
        
	<tr>
          <td>
            <h3>Creating a CDK jar file that loads into Oracle</h3>
	    The CDK jar file loaded into Oracle is built with one or two hacks, the steps of which are described below.
	    The steps are necessary because Aurora doesn't really get the various "@Test.." annotations used throughout the CDK,
	    so these source code lines must be stripped out.
	    <UL>
	        <LI>Locate the OrChem file sh/noAnn.sh, open it and make sure step1 is uncommented and step2 is commented.</LI>
	    	<LI>Git clone git://cdk.git.sourceforge.net/gitroot/cdk/cdk </LI>
	    	<LI>Navigate to the CDK's src/main folder</LI>
	    	<LI>Call noAnn.sh from within src/main</LI>
	    	<LI>Let the script run..</LI>
		<LI>When done, you have stripped out the "@Test" annotations</LI>
	    	<LI>Open noAnn.sh, comment step1 and uncomment step2, save file.</LI>
	    	<LI>Navigate to the CDK top folder where build.xml can be found</LI>
	    	<LI>Run 'ant clean dist-all'. If there are minor compiler errors (bad stripping), locate the error and fix the problem (should be easy), the run 'ant dist-all' again </LI>
	    	<LI>When compiled, move into dist/jar directory</LI>
	    	<LI>Call noAnn.sh from within the dist/jar folder</LI>
	    	<LI>Let the script run..</LI>
		<LI>You now have a cdk.jar file you can load into Oracle</LI>
	    <UL>
            <br></br>
            <a href="index.html">Back to main page</a>
            <br></br>
	   </td>
        </tr>
	
	
      </table>
    </div>

    
  </body>
</html>
